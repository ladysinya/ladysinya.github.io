<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Firestore Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #555;
            margin-top: 0;
        }
        
        input, textarea, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .data-list {
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .data-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            animation: fadeIn 0.3s ease-in;
        }
        
        .data-item:last-child {
            border-bottom: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .auth-section {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .user-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Firebase Firestore Demo</h1>
        
        <!-- Authentication Section -->
        <div class="section">
            <h2>üîê Authentication</h2>
            <div class="auth-section">
                <button id="signInBtn">Sign In with Google</button>
                <button id="signOutBtn" style="display: none;">Sign Out</button>
                <div id="userInfo" class="user-info" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Add Data Section -->
        <div class="section">
            <h2>‚ûï Add New Post</h2>
            <input type="text" id="titleInput" placeholder="Enter post title...">
            <textarea id="contentInput" placeholder="Enter post content..." rows="4"></textarea>
            <button id="addBtn">Add Post</button>
            <div id="addStatus"></div>
        </div>
        
        <!-- Display Data Section -->
        <div class="section">
            <h2>üìö All Posts</h2>
            <button id="loadBtn">Load Posts</button>
            <div id="loadStatus"></div>
            <div id="dataList" class="data-list"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            orderBy, 
            query,
            serverTimestamp 
        } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { 
            getAuth, 
            signInWithPopup, 
            GoogleAuthProvider, 
            signOut,
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

        // TODO: Replace with your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAFnfiMmZlcH7XeQNfuqXWaQJYKg4tHl-Q",
            authDomain: "ladysinyagithub.firebaseapp.com",
            projectId: "ladysinyagithub",
            storageBucket: "ladysinyagithub.firebasestorage.app",
            messagingSenderId: "800328484512",
            appId: "1:800328484512:web:0802f10bf805253becebc5",
            measurementId: "G-9EYSSRJ4CM"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // DOM elements
        const titleInput = document.getElementById('titleInput');
        const contentInput = document.getElementById('contentInput');
        const addBtn = document.getElementById('addBtn');
        const loadBtn = document.getElementById('loadBtn');
        const dataList = document.getElementById('dataList');
        const addStatus = document.getElementById('addStatus');
        const loadStatus = document.getElementById('loadStatus');
        const signInBtn = document.getElementById('signInBtn');
        const signOutBtn = document.getElementById('signOutBtn');
        const userInfo = document.getElementById('userInfo');

        // Current user
        let currentUser = null;

        // Authentication state listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                signInBtn.style.display = 'none';
                signOutBtn.style.display = 'block';
                userInfo.style.display = 'block';
                userInfo.innerHTML = `
                    <strong>Welcome, ${user.displayName}!</strong><br>
                    <small>${user.email}</small>
                `;
            } else {
                currentUser = null;
                signInBtn.style.display = 'block';
                signOutBtn.style.display = 'none';
                userInfo.style.display = 'none';
            }
        });

        // Sign in function
        async function signInWithGoogle() {
            try {
                const result = await signInWithPopup(auth, provider);
                showStatus(addStatus, 'Signed in successfully!', 'success');
            } catch (error) {
                showStatus(addStatus, `Sign in failed: ${error.message}`, 'error');
            }
        }

        // Sign out function
        async function signOutUser() {
            try {
                await signOut(auth);
                showStatus(addStatus, 'Signed out successfully!', 'success');
            } catch (error) {
                showStatus(addStatus, `Sign out failed: ${error.message}`, 'error');
            }
        }

        // Function to add data to Firestore
        async function addPost() {
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();
            
            if (!title || !content) {
                showStatus(addStatus, 'Please fill in both title and content!', 'error');
                return;
            }

            try {
                addBtn.disabled = true;
                addBtn.textContent = 'Adding...';
                
                // Create post object
                const postData = {
                    title: title,
                    content: content,
                    timestamp: serverTimestamp(),
                    author: currentUser ? currentUser.displayName : 'Anonymous',
                    authorEmail: currentUser ? currentUser.email : 'anonymous'
                };

                // Add to Firestore
                const docRef = await addDoc(collection(db, 'posts'), postData);
                
                showStatus(addStatus, `Post added successfully! ID: ${docRef.id}`, 'success');
                
                // Clear inputs
                titleInput.value = '';
                contentInput.value = '';
                
                // Auto-refresh the list
                loadPosts();
                
            } catch (error) {
                showStatus(addStatus, `Error adding post: ${error.message}`, 'error');
            } finally {
                addBtn.disabled = false;
                addBtn.textContent = 'Add Post';
            }
        }

        // Function to load data from Firestore
        async function loadPosts() {
            try {
                loadBtn.disabled = true;
                loadBtn.textContent = 'Loading...';
                dataList.innerHTML = '<div class="data-item">Loading posts...</div>';
                
                // Query posts ordered by timestamp (newest first)
                const q = query(collection(db, 'posts'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                dataList.innerHTML = '';
                
                if (querySnapshot.empty) {
                    dataList.innerHTML = '<div class="data-item">No posts found. Add some posts above!</div>';
                    showStatus(loadStatus, 'No posts found', 'error');
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const postElement = document.createElement('div');
                    postElement.className = 'data-item';
                    
                    // Format timestamp
                    let timeString = 'Just now';
                    if (data.timestamp) {
                        timeString = data.timestamp.toDate().toLocaleString();
                    }
                    
                    postElement.innerHTML = `
                        <h3 style="margin: 0 0 10px 0; color: #333;">${data.title}</h3>
                        <p style="margin: 0 0 10px 0; color: #666;">${data.content}</p>
                        <small style="color: #999;">
                            By ${data.author} ‚Ä¢ ${timeString} ‚Ä¢ ID: ${doc.id}
                        </small>
                    `;
                    
                    dataList.appendChild(postElement);
                });
                
                showStatus(loadStatus, `Loaded ${querySnapshot.size} posts successfully!`, 'success');
                
            } catch (error) {
                showStatus(loadStatus, `Error loading posts: ${error.message}`, 'error');
                dataList.innerHTML = '<div class="data-item">Error loading posts. Check console for details.</div>';
            } finally {
                loadBtn.disabled = false;
                loadBtn.textContent = 'Load Posts';
            }
        }

        // Helper function to show status messages
        function showStatus(element, message, type) {
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 5000);
        }

        // Event listeners
        addBtn.addEventListener('click', addPost);
        loadBtn.addEventListener('click', loadPosts);
        signInBtn.addEventListener('click', signInWithGoogle);
        signOutBtn.addEventListener('click', signOutUser);

        // Allow Enter key in title input
        titleInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                contentInput.focus();
            }
        });

        // Load posts on page load
        window.addEventListener('load', loadPosts);
    </script>
</body>
</html>